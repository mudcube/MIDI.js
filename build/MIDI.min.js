if("undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";var n={},t=0,o=function(e){t++;var o=document.body,r=new Audio,i=e.split(";")[0];r.id="audio",r.setAttribute("preload","auto"),r.setAttribute("audiobuffer",!0),r.addEventListener("error",function(){o.removeChild(r),n[i]=!1,t--},!1),r.addEventListener("canplaythrough",function(){o.removeChild(r),n[i]=!0,t--},!1),r.src="data:"+e,o.appendChild(r)};e.audioDetect=function(e){if(navigator.requestMIDIAccess)if(Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]"))n.webmidi=!0;else for(var r=0;navigator.plugins.length>r;r++){navigator.plugins[r].name.indexOf("Jazz-Plugin")>=0&&(n.webmidi=!0)}if("undefined"==typeof Audio)return e({});n.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(n.webaudio=!0);var i=new Audio;if(void 0===i.canPlayType)return e(n);var a=i.canPlayType('audio/ogg; codecs="vorbis"');a="probably"===a||"maybe"===a;var u=i.canPlayType("audio/mpeg");if(u="probably"===u||"maybe"===u,a||u){a&&o("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),u&&o("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var s=(new Date).getTime(),c=window.setInterval(function(){var o=(new Date).getTime();t&&!(o-s>5e3)||(window.clearInterval(c),e(n))},1)}else e(n)}}(MIDI),function(e){"use strict";e.GM=function(e){var n=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},t={byName:{},byId:{},byCategory:{}};for(var o in e)for(var r=e[o],i=0,a=r.length;i<a;i++){var u=r[i];if(u){var s=parseInt(u.substr(0,u.indexOf(" ")),10);u=u.replace(s+" ",""),t.byId[--s]=t.byName[n(u)]=t.byCategory[n(o)]={id:n(u),instrument:u,number:s,category:o}}}return t}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),e.getInstrument=function(n){var t=e.channels[n];return t&&t.instrument},e.setInstrument=function(n,t,o){var r=e.channels[n];if(o)return setTimeout(function(){r.instrument=t},o);r.instrument=t},e.getMono=function(n){var t=e.channels[n];return t&&t.mono},e.setMono=function(n,t,o){var r=e.channels[n];if(o)return setTimeout(function(){r.mono=t},o);r.mono=t},e.getOmni=function(n){var t=e.channels[n];return t&&t.omni},e.setOmni=function(n,t){var o=e.channels[n];if(delay)return setTimeout(function(){o.omni=t},delay);o.omni=t},e.getSolo=function(n){var t=e.channels[n];return t&&t.solo},e.setSolo=function(n,t){var o=e.channels[n];if(delay)return setTimeout(function(){o.solo=t},delay);o.solo=t},e.channels=function(){for(var e={},n=0;n<16;n++)e[n]={instrument:n,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),e.keyToNote={},e.noteToKey={},function(){for(var n=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],t=21;t<=108;t++){var o=n[t%12]+((t-12)/12>>0);e.keyToNote[o]=t,e.noteToKey[t]=o}}()}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(e){"use strict";e.DEBUG=!0,e.USE_XHR=!0,e.soundfontUrl="./soundfont/",e.loadPlugin=function(t){"function"==typeof t&&(t={onsuccess:t}),e.soundfontUrl=t.soundfontUrl||e.soundfontUrl,e.audioDetect(function(o){var r=window.location.hash,i="";if(o[t.api]?i=t.api:o[r.substr(1)]?i=r.substr(1):o.webmidi?i="webmidi":window.AudioContext?i="webaudio":window.Audio&&(i="audiotag"),n[i]){if(t.targetFormat)var a=t.targetFormat;else a=o["audio/ogg"]?"ogg":"mp3";e.__api=i,e.__audioFormat=a,e.supports=o,e.loadResource(t)}})},e.loadResource=function(t){var o=t.instruments||t.instrument||"acoustic_grand_piano";"object"!=typeof o&&(o=o||0===o?[o]:[]);for(var r=0;r<o.length;r++){var i=o[r];i===+i&&e.GM.byId[i]&&(o[r]=e.GM.byId[i].id)}t.format=e.__audioFormat,t.instruments=o,n[e.__api](t)};var n={webmidi:function(n){e.WebMIDI.connect(n)},audiotag:function(e){t(e,"AudioTag")},webaudio:function(e){t(e,"WebAudio")}},t=function(n,t){for(var r=n.format,i=n.instruments,a=n.onprogress,u=n.onerror,s=i.length,c=s,l=function(){--c||(a&&a("load",1),e[t].connect(n))},d=0;d<s;d++){var f=i[d];MIDI.Soundfont[f]?l():o(i[d],r,function(e,n){a&&a("load",n/s+(s-c)/s,f)},function(){l()},u)}},o=function(n,t,o,r,i){var a=e.soundfontUrl+n+"-"+t+".js";e.USE_XHR?e.util.request({url:a,format:"text",onerror:i,onprogress:o,onsuccess:function(e,n){var t=document.createElement("script");t.language="javascript",t.type="text/javascript",t.text=n,document.body.appendChild(t),r()}}):dom.loadScript.add({url:a,verify:'MIDI.Soundfont["'+n+'"]',onerror:i,onsuccess:function(){r()}})};e.setDefaultPlugin=function(n){for(var t in n)e[t]=n[t]}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),void 0===MIDI.Player&&(MIDI.Player={}),function(){"use strict";var e=MIDI.Player;e.currentTime=0,e.endTime=0,e.restart=0,e.playing=!1,e.timeWarp=1,e.startDelay=0,e.BPM=120,e.start=e.resume=function(n){e.currentTime<-1&&(e.currentTime=-1),l(e.currentTime,null,n)},e.pause=function(){var n=e.restart;d(),e.restart=n},e.stop=function(){d(),e.restart=0,e.currentTime=0},e.addListener=function(e){a=e},e.removeListener=function(){a=void 0},e.clearAnimation=function(){e.animationFrameId&&cancelAnimationFrame(e.animationFrameId)},e.setAnimation=function(n){var t=0,o=0,r=0;e.clearAnimation();var a=function(){if(e.animationFrameId=requestAnimationFrame(a),0!==e.endTime){e.playing?(t=r===e.currentTime?o-Date.now():0,t=0===e.currentTime?0:e.currentTime-t,r!==e.currentTime&&(o=Date.now(),r=e.currentTime)):t=e.currentTime;var u=e.endTime,s=t/1e3,c=s/60,l=60*c+(s-60*c),d=u/1e3;d-l<-1||n({now:l,end:d,events:i})}};requestAnimationFrame(a)},e.loadMidiFile=function(n,t,o){try{e.replayer=new Replayer(MidiFile(e.currentData),e.timeWarp,null,e.BPM),e.data=e.replayer.getData(),e.endTime=c(),MIDI.loadPlugin({onsuccess:n,onprogress:t,onerror:o})}catch(e){o&&o(e)}},e.loadFile=function(n,t,o,r){if(e.stop(),-1!==n.indexOf("base64,")){var i=window.atob(n.split(",")[1]);e.currentData=i,e.loadMidiFile(t,o,r)}else{var a=new XMLHttpRequest;a.open("GET",n),a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var n=this.responseText||"",i=[],a=n.length,u=String.fromCharCode,s=0;s<a;s++)i[s]=u(255&n.charCodeAt(s));var c=i.join("");e.currentData=c,e.loadMidiFile(t,o,r)}else r&&r("Unable to load MIDI file")},a.send()}},e.getFileInstruments=function(){for(var n={},t={},o=0;o<e.data.length;o++){var r=e.data[o][0].event;if("channel"===r.type){var i=r.channel;switch(r.subtype){case"controller":break;case"programChange":t[i]=r.programNumber;break;case"noteOn":var a=t[i];n[MIDI.GM.byId[isFinite(a)?a:i].id]=!0}}}var u=[];for(var s in n)u.push(s);return u};var n,t,o=[],r=0,i={},a=void 0,u=function(t,r,u,s,c,d,f){return setTimeout(function(){var s={channel:t,note:r,now:u,end:e.endTime,message:c,velocity:d};128===c?delete i[r]:i[r]=s,a&&a(s),e.currentTime=u,o.shift(),o.length<1e3?l(n,!0):e.currentTime===n&&n<e.endTime&&l(n,!0)},u-s)},s=function(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(e.ctx={currentTime:0},e.ctx)},c=function(){for(var n=e.data,t=n.length,o=.5,r=0;r<t;r++)o+=n[r][1];return o},l=function(i,a,l){if(e.replayer){var f;a||(void 0===i&&(i=e.restart),e.playing&&d(),e.playing=!0,e.data=e.replayer.getData(),e.endTime=c());var p=0,A=0,m=e.data,v=s(),q=m.length;n=.5;o[0]&&o[0].interval;var g=i-e.currentTime;if("webaudio"!==MIDI.api){var h=window.performance&&window.performance.now?window.performance.now():Date.now();t=t||h,v.currentTime=(h-t)/1e3}r=v.currentTime;for(var y=0;y<q&&A<100;y++){var S=m[y];if((n+=S[1])<=i)p=n;else{i=n-p;var I=S[0].event;if("channel"===I.type){var b=I.channel,T=MIDI.channels[b],w=v.currentTime+(i+g+e.startDelay)/1e3,M=n-p+e.startDelay;switch(I.subtype){case"controller":MIDI.setController(b,I.controllerType,I.value,w);break;case"programChange":MIDI.programChange(b,I.programNumber,w);break;case"pitchBend":MIDI.pitchBend(b,I.value,w);break;case"noteOn":if(T.mute)break;f=I.noteNumber-(e.MIDIOffset||0),o.push({event:I,time:M,source:MIDI.noteOn(b,I.noteNumber,I.velocity,w),interval:u(b,f,n+e.startDelay,p-g,144,I.velocity)}),A++;break;case"noteOff":if(T.mute)break;f=I.noteNumber-(e.MIDIOffset||0),o.push({event:I,time:M,source:MIDI.noteOff(b,I.noteNumber,w),interval:u(b,f,n,p-g,128,0)})}}}}l&&l(o)}},d=function(){var n=s();for(e.playing=!1,e.restart+=1e3*(n.currentTime-r);o.length;){var t=o.pop();window.clearInterval(t.interval),t.source&&("number"==typeof t.source?window.clearTimeout(t.source):t.source.disconnect(0))}for(var u in i){t=i[u];144===i[u].message&&a&&a({channel:t.channel,note:t.note,now:t.now,end:t.end,message:128,velocity:t.velocity})}i={}}}(),function(e){"use strict";window.Audio&&function(){for(var n=e.AudioTag={api:"audiotag"},t={},o=127,r=-1,i=[],a=[],u={},s=0;s<12;s++)i[s]=new Audio;var c=function(n,t){if(e.channels[n]){var s=e.channels[n].instrument,c=e.GM.byName[s].id;if(t=u[t]){var l=c+""+t.id,d=(r+1)%i.length,f=i[d];if(a[d]=l,!e.Soundfont[c])return void(e.DEBUG&&console.log("404",c));f.src=e.Soundfont[c][t.id],f.volume=o/127,f.play(),r=d}}},l=function(n,t){if(e.channels[n]){var o=e.channels[n].instrument,s=e.GM.byName[o].id;if(t=u[t])for(var c=s+""+t.id,l=0,d=i.length;l<d;l++){var f=(l+r+1)%d,p=a[f];if(p&&p==c)return i[f].pause(),void(a[f]=null)}}};n.audioBuffers=i,n.send=function(e,n){},n.setController=function(e,n,t,o){},n.setVolume=function(e,n){o=n},n.programChange=function(n,t){e.channels[n].instrument=t},n.pitchBend=function(e,n,t){},n.noteOn=function(e,n,o,r){var i=t[n];if(u[i])return r?setTimeout(function(){c(e,i)},1e3*r):void c(e,i)},n.noteOff=function(e,n,t){},n.chordOn=function(e,n,o,r){for(var i=0;i<n.length;i++){var a=n[i],s=t[a];if(u[s]){if(r)return setTimeout(function(){c(e,s)},1e3*r);c(e,s)}}},n.chordOff=function(e,n,o){for(var r=0;r<n.length;r++){var i=n[r],a=t[i];if(u[a]){if(o)return setTimeout(function(){l(e,a)},1e3*o);l(e,a)}}},n.stopAllNotes=function(){for(var e=0,n=i.length;e<n;e++)i[e].pause()},n.connect=function(o){for(var r in e.setDefaultPlugin(n),e.keyToNote)t[e.keyToNote[r]]=r,u[r]={id:r};o.onsuccess&&o.onsuccess()}}()}(MIDI),function(e){"use strict";window.AudioContext&&function(){var n,t=!1,o=e.WebAudio={api:"webaudio"},r={},i={},a=127,u={};o.audioBuffers=u,o.send=function(e,n){},o.setController=function(e,n,t,o){},o.setVolume=function(e,n,t){t?setTimeout(function(){a=n},1e3*t):a=n},o.programChange=function(n,t,o){e.channels[n].instrument=t},o.pitchBend=function(n,t,o){e.channels[n].pitchBend=t},o.noteOn=function(o,s,c,l){l=l||0;var d=e.channels[o].instrument,f=u[d+""+s];if(f){if(l<n.currentTime&&(l+=n.currentTime),t)var p=n.createMediaElementSource(f);else(p=n.createBufferSource()).buffer=f;if(i){var A=p;for(var m in i)A.connect(i[m].input),A=i[m]}var v=c/127*(a/127)*2-1;if(p.connect(n.destination),p.playbackRate.value=1,p.gainNode=n.createGain(),p.gainNode.connect(n.destination),p.gainNode.gain.value=Math.min(1,Math.max(-1,v)),p.connect(p.gainNode),t){if(l)return setTimeout(function(){f.currentTime=0,f.play()},1e3*l);f.currentTime=0,f.play()}else p.start(l||0);return r[o+""+s]=p,p}},o.noteOff=function(o,i,a){a=a||0;var s=e.channels[o].instrument,c=u[s+""+i];if(c){a<n.currentTime&&(a+=n.currentTime);var l=r[o+""+i];if(l){if(l.gainNode){var d=l.gainNode.gain;d.linearRampToValueAtTime(d.value,a),d.linearRampToValueAtTime(-1,a+.3)}return t?a?setTimeout(function(){c.pause()},1e3*a):c.pause():l.noteOff?l.noteOff(a+.5):l.stop(a+.5),delete r[o+""+i],l}}},o.chordOn=function(e,n,t,r){for(var i,a={},u=0,s=n.length;u<s;u++)a[i=n[u]]=o.noteOn(e,i,t,r);return a},o.chordOff=function(e,n,t){for(var r,i={},a=0,u=n.length;a<u;a++)i[r=n[a]]=o.noteOff(e,r,t);return i},o.stopAllNotes=function(){for(var e in r){var t=0;t<n.currentTime&&(t+=n.currentTime);var o=r[e];o.gain.linearRampToValueAtTime(1,t),o.gain.linearRampToValueAtTime(0,t+.3),o.noteOff?o.noteOff(t+.3):o.stop(t+.3),delete r[e]}},o.setEffects=function(e){if(!n.tunajs)return console.log("Effects module not installed.");for(var t=0;t<e.length;t++){var o=e[t],r=new n.tunajs[o.type](o);r.connect(n.destination),i[o.type]=r}},o.connect=function(t){e.setDefaultPlugin(o),o.setContext(n||new(window.AudioContext||window.webkitAudioContext),t.onsuccess)},o.getContext=function(){return n},o.setContext=function(o,r,i,a){n=o,"undefined"==typeof Tuna||n.tunajs||(n.tunajs=new Tuna(n));var s=[],c=e.keyToNote;for(var l in c)s.push(l);var d=function(e){for(var n in p)if(p[n])return;r&&(r(),r=null)},f=function(o,r,i,a){var s=o[a];s&&(p[r]++,function(e,o,r){if(t){var i=new Audio;i.src=e,i.controls=!1,i.autoplay=!1,i.preload=!1,i.addEventListener("canplay",function(){o&&o(i)}),i.addEventListener("error",function(e){r&&r(e)}),document.body.appendChild(i)}else if(0===e.indexOf("data:audio")){var a=e.split(",")[1],u=Base64Binary.decodeArrayBuffer(a);n.decodeAudioData(u,o,r)}else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){n.decodeAudioData(s.response,o,r)},s.send()}}(s,function(n){n.id=a;var t=e.keyToNote[a];if(u[r+""+t]=n,0==--p[r]){o.isLoaded=!0,d()}},function(e){}))},p={};for(var A in e.Soundfont){var m=e.Soundfont[A];if(!m.isLoaded){var v=e.GM.byName[A].id;p[v]=0;for(var q=0;q<s.length;q++){f(m,v,0,l=s[q])}}}setTimeout(d,1)}}()}(MIDI),function(e){"use strict";var n=null,t=e.WebMIDI={api:"webmidi"};t.send=function(e,t){n.send(e,1e3*t)},t.setController=function(e,t,o,r){n.send([e,t,o],1e3*r)},t.setVolume=function(e,t,o){n.send([176+e,7,t],1e3*o)},t.programChange=function(e,t,o){n.send([192+e,t],1e3*o)},t.pitchBend=function(e,t,o){n.send([224+e,t],1e3*o)},t.noteOn=function(e,t,o,r){n.send([144+e,t,o],1e3*r)},t.noteOff=function(e,t,o){n.send([128+e,t,0],1e3*o)},t.chordOn=function(e,t,o,r){for(var i=0;i<t.length;i++){var a=t[i];n.send([144+e,a,o],1e3*r)}},t.chordOff=function(e,t,o){for(var r=0;r<t.length;r++){var i=t[r];n.send([128+e,i,0],1e3*o)}},t.stopAllNotes=function(){n.cancel();for(var e=0;e<16;e++)n.send([176+e,123,0])},t.connect=function(o){e.setDefaultPlugin(t);var r=function(n){if(window.AudioContext)o.api="webaudio";else{if(!window.Audio)return;o.api="audiotag"}e.loadPlugin(o)};navigator.requestMIDIAccess().then(function(e){var t=e.outputs;void 0===(n="function"==typeof t?t()[0]:t[0])?r():o.onsuccess&&o.onsuccess()},r)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),function(e){if((e.util||(e.util={})).request=function(t,o,r,i){"use strict";"string"==typeof t&&(t={url:t});var a=t.data,u=t.url,s=t.method||(t.data?"POST":"GET"),c=t.format,l=t.headers,d=t.responseType,f=t.withCredentials||!1;o=o||t.onsuccess,r=r||t.onerror,i=i||t.onprogress;if(void 0===n||!e.loc.isLocalUrl(u)){var p=new XMLHttpRequest;if(p.open(s,u,!0),l)for(var A in l)p.setRequestHeader(A,l[A]);else a&&p.setRequestHeader("Content-type","application/x-www-form-urlencoded");return"binary"===c&&p.overrideMimeType&&p.overrideMimeType("text/plain; charset=x-user-defined"),d&&(p.responseType=d),f&&(p.withCredentials="true"),r&&"onerror"in p&&(p.onerror=r),i&&p.upload&&"onprogress"in p.upload&&(a?p.upload.onprogress=function(e){i.call(p,e,event.loaded/event.total)}:p.addEventListener("progress",function(e){var n=0;if(e.lengthComputable)n=e.total;else if(p.totalBytes)n=p.totalBytes;else{var t=parseInt(p.getResponseHeader("Content-Length-Raw"));if(!isFinite(t))return;p.totalBytes=n=t}i.call(p,e,e.loaded/n)})),p.onreadystatechange=function(n){if(4===p.readyState)if(200===p.status||304===p.status||308===p.status||0===p.status&&e.client.cordova){if(o){var t;if("xml"===c)t=n.target.responseXML;else if("text"===c)t=n.target.responseText;else if("json"===c)try{t=JSON.parse(n.target.response)}catch(e){r&&r.call(p,n)}o.call(p,n,t)}}else r&&r.call(p,n)},p.send(a),p}n.readFile(u,"utf8",function(e,n){e?r&&r(e):o&&o({responseText:n})})},"undefined"!=typeof module&&module.exports){var n=require("fs");XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=e.util.request}}(MIDI),void 0===dom)var dom={};!function(){"use strict";dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(n){var t=this;"string"==typeof n&&(n={url:n});var o=n.urls;void 0===o&&(o=[{url:n.url,verify:n.verify}]);var r=document.getElementsByTagName("head")[0],i=function(n,o){t.loaded[n.url]||o&&!1===e(o)||(t.loaded[n.url]=!0,t.loading[n.url]&&t.loading[n.url](),delete t.loading[n.url],n.onsuccess&&n.onsuccess(),void 0!==f&&f())},a=!1,u=[],s=function(e){if("string"==typeof e&&(e={url:e,verify:n.verify}),/([\w\d.\[\]\'\"])$/.test(e.verify)){var o=e.test=e.verify;if("object"==typeof o)for(var s=0;s<o.length;s++)u.push(o[s]);else u.push(o)}if(!t.loaded[e.url]){var l=document.createElement("script");l.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||i(e)},l.onload=function(){i(e)},l.onerror=function(){if(a=!0,delete t.loading[e.url],"object"==typeof e.test)for(var n in e.test)c(e.test[n]);else c(e.test)},l.setAttribute("type","text/javascript"),l.setAttribute("src",e.url),r.appendChild(l),t.loading[e.url]=function(){}}},c=function(e){for(var n=[],t=0;t<u.length;t++)u[t]!==e&&n.push(u[t]);u=n},l=function(t){if(t)i(t,t.test);else for(var r=0;r<o.length;r++)i(o[r],o[r].test);var s=!0;for(r=0;r<u.length;r++)!1===e(u[r])&&(s=!1);!n.strictOrder&&s?a?n.error&&n.error():n.onsuccess&&n.onsuccess():setTimeout(function(){l(t)},10)};if(n.strictOrder){var d=-1,f=function(){if(o[++d]){var e=o[d],r=e.url;t.loading[r]?t.loading[r]=function(){e.onsuccess&&e.onsuccess(),f()}:t.loaded[r]?f():(s(e),l(e))}else a?n.error&&n.error():n.onsuccess&&n.onsuccess()};f()}else for(d=0;d<o.length;d++)s(o[d]),l(o[d])},dom.loadScript=new dom.loadScript;var e=function(e,n){try{for(var t=(e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".")).split("."),o=t.length,r=n||window,i=0;i<o;i++){var a=t[i];if(null==r[a])return!1;r=r[a]}return!0}catch(e){return!1}}}(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript);
